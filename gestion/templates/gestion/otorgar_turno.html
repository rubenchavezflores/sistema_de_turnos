{% extends 'gestion/base.html' %}

{% block title %}Otorgar Turno{% endblock %}

{% block content %}
<h3>Otorgar Turno: {{ medico.apellido|upper }} {{ medico.nombre|title }} - {{ medico.especialidad.nombre }}</h3>

{% if dias_atencion %}
    <h5>Días de atención:</h5>
    <ul>
    {% for dia in dias_atencion %}
        <li>
            {{ dia.dia }}: {{ dia.horario_inicio }} a {{ dia.horario_fin }} - cada {{ dia.intervalo_minutos }} minutos
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>Este médico no tiene días de atención configurados.</p>
{% endif %}


<form method="post" class="mb-3">
    {% csrf_token %}
    <h5>Buscar Paciente por DNI</h5>
    <div class="mb-3">
        <label for="dni" class="form-label">DNI:</label>
        <input type="text" name="dni" class="form-control" value="{{ dni }}">
    </div>
    <button type="submit" class="btn btn-info">Buscar</button>
</form>

{% if paciente %}
    <div class="alert alert-success">
        Paciente encontrado: {{ paciente.nombre }} {{ paciente.apellido }}
    </div>

    <h5>Asignar Turno</h5>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="dni" value="{{ paciente.dni }}">
        <div class="mb-3">
            <label class="form-label">Fecha del turno:</label>
            <input type="date" name="fecha" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Guardar Turno</button>
    </form>

{% elif dni %}
    <div class="alert alert-warning">
        Paciente no registrado. Por favor completar los datos para registrar y asignar el turno:
    </div>

    <h5>Registrar Paciente y Asignar Turno</h5>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="dni" value="{{ dni }}">
        <div class="mb-3">
            <label class="form-label">Nombre:</label>
            <input type="text" name="nombre" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Apellido:</label>
            <input type="text" name="apellido" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Fecha del turno:</label>
            <input type="date" name="fecha" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Registrar y Guardar Turno</button>
    </form>
{% endif %}


<a href="{% url 'inicio' %}" class="btn btn-secondary mt-3">← Volver al inicio</a>
{% endblock %}
